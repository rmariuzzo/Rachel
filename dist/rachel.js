"use strict";function createApi(e){var t=e;return{list:function(e,r){return _list(e,_extends({},t,r))},get:function(e,r){return _get(e,_extends({},t,r))},post:function(e,r){return _post(e,_extends({},t,r))},put:function(e,r){return _put(e,_extends({},t,r))},del:function(e,r){return _del(e,_extends({},t,r))}}}function _list(e,t){if("string"!=typeof e)throw new Error("the path must be a string");var r=t;return function(t){return request(e,_extends({},r,t,{method:"GET"}))}}function _get(e,t){if("string"!=typeof e)throw new Error("the path must be a string");var r=t;return function(t,n){return request(e,_extends({},r,n,{method:"GET",id:t}))}}function _post(e,t){if("string"!=typeof e)throw new Error("the path must be a string");var r=t;return function(t,n){return request(e,_extends({},r,n,{method:"POST",data:t}))}}function _put(e,t){if("string"!=typeof e)throw new Error("the path must be a string");var r=t;return function(t,n,u){return request(e,_extends({},r,u,{method:"PUT",id:t,data:n}))}}function _del(e,t){if("string"!=typeof e)throw new Error("the path must be a string");var r=t;return function(t,n){return request(e,_extends({},r,n,{method:"DELETE",id:t}))}}function request(e,t){void 0!==t.id&&(e=formatUri(e,{id:t.id})),void 0!==t.data&&(e=formatUri(e,t.data)),t.prefix&&(e=t.prefix+e);var r=t.method+": "+e;if(t.cache){if(request.cache[r])return request.cache[r].promise;request.cache[r]={},request.cache[r].promise=new Promise(function(e){request.cache[r].resolve=e})}else delete request.cache[r];if(t.queue&&request.queue[e])return request.queue[e];var n={method:t.method,headers:{"Content-Type":"application/json"}};return t.data&&(n.body=JSON.stringify(t.data)),request.queue[e]=fetch(e,n).then(function(e){if(e.ok)return e;throw new Error("bad status code: "+e.status)}).then(function(e){return e.json()}).then(function(e){return t.extract?e[t.extract]:e}).then(function(n){return t.cache&&request.cache[r].resolve(n),delete request.queue[e],n}).catch(function(n){if(t.cache&&(request.cache[r].reject(n),delete request.cache[r]),delete request.queue[e],!t.cache)throw Error(n)})}function formatUri(e,t){return e.replace(/:(\w+)/g,function(e,r){return t[r]})}var asyncGenerator=function(){function e(e){this.value=e}function t(t){function r(u,o){try{var i=t[u](o),c=i.value;c instanceof e?Promise.resolve(c.value).then(function(e){r("next",e)},function(e){r("throw",e)}):n(i.done?"return":"normal",i.value)}catch(e){n("throw",e)}}function n(e,t){switch(e){case"return":u.resolve({value:t,done:!0});break;case"throw":u.reject(t);break;default:u.resolve({value:t,done:!1})}(u=u.next)?r(u.key,u.arg):o=null}var u,o;this._invoke=function(e,t){return new Promise(function(n,i){var c={key:e,arg:t,resolve:n,reject:i,next:null};o?o=o.next=c:(u=o=c,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rachel={createApi:createApi,list:_list,get:_get,post:_post,put:_put,del:_del};request.cache={},request.queue={},module.exports=Rachel;
