!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Rachel=e()}(this,function(){"use strict";function t(t,e){if("string"!=typeof t)throw new Error("the path must be a string");var n=e;return function(e){return u(t,c({},n,e,{method:"GET"}))}}function e(t,e){if("string"!=typeof t)throw new Error("the path must be a string");var n=e;return function(e,r){return u(t,c({},n,r,{method:"GET",id:e}))}}function n(t,e){if("string"!=typeof t)throw new Error("the path must be a string");var n=e;return function(e,r){return u(t,c({},n,r,{method:"POST",data:e}))}}function r(t,e){if("string"!=typeof t)throw new Error("the path must be a string");var n=e;return function(e,r,o){return u(t,c({},n,o,{method:"PUT",id:e,data:r}))}}function o(t,e){if("string"!=typeof t)throw new Error("the path must be a string");var n=e;return function(e,r){return u(t,c({},n,r,{method:"DELETE",id:e}))}}function u(t,e){e.prefix&&(t=e.prefix+t),e.baseUrl&&(t=e.baseUrl+t),void 0!==e.id&&(t=i(t,{id:e.id})),void 0!==e.data&&(t=i(t,e.data));var n=e.method+": "+t;if(e.cache){if(u.cache[n])return u.cache[n].promise;u.cache[n]={},u.cache[n].promise=new Promise(function(t){u.cache[n].resolve=t})}else delete u.cache[n];if(e.queue&&u.queue[t])return u.queue[t];var r={method:e.method,headers:{"Content-Type":"application/json"}};return e.data&&(r.body=JSON.stringify(e.data)),u.queue[t]=fetch(t,r).then(function(t){if(t.ok)return t;throw new Error("bad status code: "+t.status)}).then(function(t){return t.json()}).then(function(t){return e.extract?t[e.extract]:t}).then(function(r){return e.cache&&u.cache[n].resolve(r),delete u.queue[t],r}).catch(function(r){if(e.cache&&(u.cache[n].reject(r),delete u.cache[n]),delete u.queue[t],!e.cache)throw Error(r)})}function i(t,e){return t.replace(/:(\w+)/g,function(t,n){return e[n]})}!function(){function t(t){this.value=t}function e(e){function n(o,u){try{var i=e[o](u),c=i.value;c instanceof t?Promise.resolve(c.value).then(function(t){n("next",t)},function(t){n("throw",t)}):r(i.done?"return":"normal",i.value)}catch(t){r("throw",t)}}function r(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?n(o.key,o.arg):u=null}var o,u;this._invoke=function(t,e){return new Promise(function(r,i){var c={key:t,arg:e,resolve:r,reject:i,next:null};u?u=u.next=c:(o=u=c,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();var c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a={createApi:function(u,i){if("string"!=typeof u)throw new Error("the base URL must be a string");var a=c({baseUrl:u},i);return{list:function(e,n){return t(e,c({},a,n))},get:function(t,n){return e(t,c({},a,n))},post:function(t,e){return n(t,c({},a,e))},put:function(t,e){return r(t,c({},a,e))},del:function(t,e){return o(t,c({},a,e))}}},list:t,get:e,post:n,put:r,del:o};return u.cache={},u.queue={},a});
